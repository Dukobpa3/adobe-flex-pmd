<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:model="com.adobe.ac.pmd.view.model.*"
    xmlns:mx="http://www.adobe.com/2006/mxml"
    xmlns:view="com.adobe.ac.pmd.view.*"
    width="100%"
    height="100%"
    horizontalAlign="center"
    verticalAlign="middle"
    >

    <mx:Script>
        <![CDATA[
            import com.adobe.ac.pmd.model.Violation;
            import mx.collections.ArrayCollection;

            public function set results( value : ArrayCollection ) : void
            {
                model.violations = value;
                gc.refresh();
            }

            private function currentVisibilityChange() : void
            {
                gc.refresh();
            }

            private function groupLabelFunction( item : Object, column : AdvancedDataGridColumn ) : String // NO PMD
            {
                if ( item && item.children )
                {
                    return item[ gc.grouping.label ] + " (" + item.children.length + ")";
                }
                else
                {
                    return item[ column.dataField ];
                }
            }
        ]]>
    </mx:Script>

    <model:ResultsModel id="model"
        currentVisibilityChange="currentVisibilityChange()"
        />

    <mx:GroupingCollection id="gc"
        source="{ model.violations }"
        grouping="{ model.grouping }"
        />

    <view:Summary model="{ model }"
        />

    <mx:HRule width="100%"
        styleName="flexUnitHRule"
        />

    <view:FilterResults model="{ model }"
        />

    <mx:HRule width="100%"
        styleName="flexUnitHRule"
        />

    <mx:HBox width="100%"
        height="100%"
        >

        <mx:AdvancedDataGrid id="dg"
            width="100%"
            height="100%"
            dataProvider="{ gc }"
            change="model.selectedViolation = dg.selectedItem as Violation"
            groupLabelFunction="groupLabelFunction"
            >

            <mx:columns>

                <mx:AdvancedDataGridColumn dataField="shortPath"
                    headerText=""
                    sortable="false"
                    />

                <mx:AdvancedDataGridColumn width="100"
                    labelFunction="ResultsFormatter.formatViolationsNumberOrBeginLine"
                    dataField="beginLine"
                    headerText="Line"
                    sortable="false"
                    />

                <mx:AdvancedDataGridColumn dataField="message"
                    dataTipField="message"
                    headerText="Message"
                    sortable="false"
                    />

                <mx:AdvancedDataGridColumn width="100"
                    dataField="priority"
                    headerText="Priority"
                    sortable="false"
                    />

            </mx:columns>

        </mx:AdvancedDataGrid>

        <view:SelectedViolation includeInLayout="{ model.selectedViolation != null }"
            close="model.selectedViolation = null"
            violation="{ model.selectedViolation }"
            visible="{ model.selectedViolation != null }"
            />

    </mx:HBox>

</mx:VBox>
